{"version":3,"file":"index-154f8a56.js","sources":["../../../../stores/disable-user.ts","../../../../components/DisableUser.vue","../../../../components/DisableUserDialog.vue","../../../../components/TheUsers.vue","../../../../pages/users/index.vue"],"sourcesContent":["import { User } from \"~/server/src/user\";\n\nexport interface DisableUserState {\n  pending: boolean;\n  responseOK: boolean;\n  nonFieldErrors: string;\n  fieldErrors: Array<{ field: string; description: string }> | null;\n  actionIsToDisable: boolean;\n}\n\nexport const useDisableUserStore = defineStore(\"disable-user-store\", {\n  state: (): DisableUserState => ({\n    pending: false,\n    responseOK: false,\n    nonFieldErrors: \"\",\n    fieldErrors: null,\n    actionIsToDisable: false,\n    refreshFunction: null,\n  }),\n\n  actions: {\n    async disableUser(accessToken: string, status: number, userID: number) {\n      console.log(status);\n      try {\n        this.pending = true;\n        let nonFieldErrors = \"\";\n        let fieldErrors = null;\n        let responseOK = false;\n        this.responseOK = responseOK;\n\n        const { data } = await useFetch(\"/api/users/disable\", {\n          method: \"put\",\n          body: { accessToken, status, userID },\n\n          async onResponse({ request, response, options }) {\n            // Process the response data\n            if (response.ok) {\n              responseOK = true;\n            }\n          },\n\n          async onResponseError({ request, response, options }) {\n            if (response.status == 400) {\n              fieldErrors = response._data?.data.errors;\n              \n            }\n            if (response.status == 401) {\n              nonFieldErrors = \"Unauthorised\";\n            }\n            if (response.status === 403) {\n              nonFieldErrors = response._data?.data.error;\n            }\n            if (response.status === 404) {\n              nonFieldErrors = response._data?.data.error;\n            }\n            if (response.status === 500) {\n              nonFieldErrors = \"Internal Error\";\n            }\n          },\n        });\n\n        this.pending = false;\n        this.fieldErrors = fieldErrors;\n        this.nonFieldErrors = nonFieldErrors;\n        this.responseOK = responseOK;\n      } catch (err) {\n        this.pending = false;\n      }\n    },\n    setDisableAction(payload: boolean) {\n      this.actionIsToDisable = payload;\n    },\n    setRefreshFunction(payload) {\n      this.refreshFunction = payload;\n    },\n  },\n});\n","<script setup lang=\"ts\">\nimport { User } from \"~/server/src/user\";\nimport { useAuthStore } from \"../stores/login\";\nimport { useUserStore } from \"../stores/user\";\nimport { useDisableUserStore } from \"../stores/disable-user\";\n\nimport { useDialogStore } from \"~/stores/dialogs\"\nconst errors = ref();\nconst { disableUser, refreshFunction } = useDisableUserStore();\nconst { closeDisableUserDialog } = useDialogStore();\nconst { actionIsToDisable } = storeToRefs(useDisableUserStore());\nconst { pending, nonFieldErrors, fieldErrors, responseOK } = storeToRefs(\n    useDisableUserStore()\n);\nconst { user } = storeToRefs(useAuthStore());\n\nconst { selectedUser } = storeToRefs(useUserStore());\nconst users: User = ref(selectedUser.value);\n\nconst userDisable = async () => {\n    const accessToken = user.value.refresh_token;\n    console.log(actionIsToDisable.value)\n    let status\n    if (actionIsToDisable.value) {\n        // console.log(\"A\")\n        status = 0\n    } else {\n        // console.log(\"B\")\n        status = 1\n    }\n    console.log(status)\n    await disableUser(accessToken, status, users.value.id);\n    if (responseOK.value) {\n        closeDisableUserDialog();\n        refreshFunction()\n    }\n};\n</script>\n<template>\n    <div class=\" mx-auto\">\n        <p class=\" flex justify-center items-center\">Are you sure!</p>\n        <p class=\"text-red-500 mb-6 text-sm\">{{ fieldErrors }}</p>\n        <div class=\"flex justify-end\">\n            <button @click=\"userDisable\"\n                class=\"inline-flex rounded-lg text-sm font-semibold py-2.5 px-4 text-sky-50 bg-teal-700 hover:text-sky-50/80 hover:bg-teal-600\">\n                <spin v-if=\"pending\" />\n                <span v-else>Confirm</span>\n            </button>\n        </div>\n    </div>\n</template>","<script setup lang=\"ts\">\nimport { TransitionRoot } from \"@headlessui/vue\";\nimport { storeToRefs } from \"pinia\";\nimport { useDialogStore } from \"../stores/dialogs\";\n\nconst props = defineProps({\n    refreshUsers: {\n        type: Function,\n        required: true,\n    },\n});\n\nconst { showDisableUserDialog } = storeToRefs(useDialogStore());\nconst { closeDisableUserDialog } = useDialogStore();\n</script>\n<template>\n    <TransitionRoot as=\"template\" :show=\"showDisableUserDialog\">\n        <DialogComponent :closeFunc=\"closeDisableUserDialog\">\n            <DialogHead>Update Status</DialogHead>\n            <DialogTitle> </DialogTitle>\n\n            <div class=\"w-full p-4 space-y-3\">\n                <DisableUser />\n            </div>\n            <DialogFooter>\n                <p class=\"text-sm text-gray-600\"></p>\n            </DialogFooter>\n        </DialogComponent>\n    </TransitionRoot>\n</template>","<script setup lang=\"ts\">\nimport { useAuthStore, } from \"../stores/login\";\nimport { useDateFormat } from \"@vueuse/core\";\nimport { EllipsisHorizontalIcon } from \"@heroicons/vue/20/solid\";\nimport { useDialogStore } from \"../stores/dialogs\";\n\n\nconst formatter = ref(\"MM/DD/YYYY\");\nconst searchValue = ref();\n\n\nconst { user } = storeToRefs(useAuthStore());\nconst { openDisableUserDialog } = useDialogStore();\nconst { setDisableAction, setRefreshFunction } = useDisableUserStore();\nconst { setSelectedUser } = useUserStore();\n\n\n\nconst test = ref();\nconst pageSize = ref(10);\nconst pageID = ref(1);\nconst {\n  data: users,\n  pending,\n  error,\n  refresh,\n} = await useFetch(\"/api/users/list\", {\n  query: {\n    pageSize: pageSize.value,\n    pageID: pageID.value,\n    accessToken: user.value.refresh_token,\n  },\n});\nrefresh();\n\n// const formatDate = (date: Date) => useDateFormat(date, formatter);\n\n// launch disable \nconst disableUser = (user) => {\n  setSelectedUser(user)\n  setRefreshFunction(refresh)\n  if (user.user_status == 1) {\n    setDisableAction(true)\n  } else if (user.user_status == 0) {\n    setDisableAction(false)\n\n  }\n  openDisableUserDialog()\n\n}\n// formatdate\nfunction formatDate(date) {\n  var d = new Date(date),\n    month = '' + (d.getMonth() + 1),\n    day = '' + d.getDate(),\n    year = d.getFullYear();\n\n  if (month.length < 2)\n    month = '0' + month;\n  if (day.length < 2)\n    day = '0' + day;\n\n  return [day, month, year].join('-');\n}\n\nconst isChecked = (status) => {\n  if (status === 1) {\n    return true;\n  }\n  if (status === 0) {\n    return false;\n\n  }\n}\n// \nconst detail = (user) => {\n  console.log(user.value);\n  setSelectedUser(user)\n  navigateTo(\"/detail\")\n\n}\n\n// search User by name\nconst filterUsers = () => {\n  if (!users) return;\n  if (users.value) {\n    users.value = users.value.filter((user) =>\n      user.username.toLowerCase().includes(searchValue.value.toLowerCase())\n    );\n  }\n  else {\n    return users.value;\n  }\n  console.log(test)\n  console.log(users.value);\n\n}\n</script>\n<template>\n  <div class=\" flex justify-start\">\n    Users\n  </div>\n\n  <div class=\"flex justify-end\">\n    <form class=\"mb-3 w-1/3\" @submit.prevent=\"filterUsers\">\n      <label for=\"default-search\" class=\"mb-2 text-sm font-medium text-gray-900 sr-only\">Search</label>\n      <div class=\"relative\">\n        <div class=\"absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none\">\n          <svg aria-hidden=\"true\" class=\"w-5 h-5 text-gray-500\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"\n            xmlns=\"http://www.w3.org/2000/svg\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\"\n              d=\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z\"></path>\n          </svg>\n        </div>\n        <input type=\"search\" id=\"default-search\"\n          class=\"block w-full p-3 pl-10 text-sm text-gray-900 border border-gray-300 rounded-lg bg-gray-50 focus:outline-teal-700 focus:ring-teal-500 focus:border-0\"\n          placeholder=\"Search users...\" v-model=\"searchValue\" required />\n        <button type=\"submit\"\n          class=\"text-white absolute right-2.5 bottom-2.5 bg-teal-700 hover:bg-teal-800 focus:ring-4 focus:outline-none focus:ring-teal-300 font-medium rounded-lg text-sm px-2 py-1\">\n          Search\n        </button>\n      </div>\n    </form>\n  </div>\n  <br />\n  <Spin v-if=\"pending\" class=\"h-20 w-20 text-teal-700\" />\n  <div v-else class=\"shadow overflow-scroll border-b border-gray-200 sm:rounded-lg\">\n    <div class=\"overflow-auto h-[35rem] relative shadow-md sm:rounded-lg\">\n      <table class=\"w-full text-sm text-left text-gray-500\">\n        <thead class=\"text-xs text-gray-700  bg-gray-200\">\n          <tr class=\"divide-x divide-gray-300\">\n            <th scope=\"col\" class=\"py-3 px-6\"></th>\n            <th scope=\"col\" class=\"py-3 px-6\">User name</th>\n            <th scope=\"col\" class=\"py-3 px-6\">Phone Number</th>\n            <th scope=\"col\" class=\"py-3 px-6\">ID number</th>\n            <th scope=\"col\" class=\"py-3 px-6\">Salary</th>\n            <th scope=\"col\" class=\"py-3 px-6\">Loan</th>\n            <th scope=\"col\" class=\"py-3 px-6\">Balance</th>\n            <th scope=\"col\" class=\"py-3 px-6\">Company</th>\n            <th scope=\"col\" class=\"py-3 px-6\">Branch</th>\n            <th scope=\"col\" class=\"py-3 px-6\">Assignment</th>\n            <th scope=\"col\" class=\"py-3 px-6\">Status</th>\n            <th scope=\"col\" class=\"py-3 px-6\">Created at</th>\n            <th scope=\"col\" class=\"py-3 px-6\">Enable/Disable</th>\n            <th scope=\"col\" class=\"py-3 px-6\">Details</th>\n          </tr>\n        </thead>\n        <tbody>\n          <tr v-for=\"(user, index) in users\" :key=\"user.phone_number\" :class=\"{ 'bg-gray-50': index % 2 === 1 }\"\n            class=\"bg-white border-b divide-x hover:bg-teal-100 cursor-pointer\">\n            <th scope=\"row\" class=\"py-4 px-6 font-medium text-gray-900 whitespace-nowrap\">\n              {{ index + 1 }}\n            </th>\n            <td class=\"py-4 px-6\">{{ user.full_names }}</td>\n            <td class=\"py-4 px-6\">{{ user.phone_number }}</td>\n            <td class=\"py-4 px-6\">{{ user.national_id_number.String }}</td>\n            <td class=\"py-4 px-6\">{{ user.net_salary }}</td>\n            <td class=\"py-4 px-6\">{{ user.loan_amount }}</td>\n            <td class=\"py-4 px-6\">{{ user.balance }}</td>\n            <td class=\"py-4 px-6\">{{ user.company_name }}</td>\n            <td class=\"py-4 px-6\">{{ user.branch_name }}</td>\n            <td class=\"py-4 px-6\">{{ user.assignment }}</td>\n            <td class=\"py-4 px-6 text-sm\">\n              <label v-if=\"user.user_status === 0\">\n                Not Active\n              </label>\n              <label v-if=\"user.user_status === 1\">\n                Active\n              </label>\n            </td>\n            <td class=\"py-4 px-6\">{{ formatDate(user.created_at) }}</td>\n            <td class=\"py-4 px-6\" @click=\"disableUser(user)\">\n              <label class=\"inline-flex relative items-center mr-5 cursor-pointer\">\n                <input type=\"checkbox\" value=\"\" class=\"sr-only peer\" :checked=\"isChecked(user.user_status)\" />\n                <div\n                  class=\"w-11 h-6 bg-gray-200 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-teal-600\">\n                </div>\n                <!-- {{ user.user_status }} -->\n              </label>\n            </td>\n            <td class=\"py-4 px-6 cursor-pointer\" @click=\"detail(user)\">\n              <EllipsisHorizontalIcon class=\"text-teal-700 h-6 w-6\" />\n            </td>\n          </tr>\n        </tbody>\n      </table>\n    </div>\n  </div>\n  <DisableUserDialog :refresh-users=\"refresh\" />\n</template>\n","<template>\n  <TheUsers />\n  <NuxtLink to=\"/users/addbulk\">\n    <PlusButton />\n  </NuxtLink>\n</template>\n"],"names":["_withAsyncContext","_ssrRenderComponent"],"mappings":"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"}