{"version":3,"file":"Update-cd50b91c.js","sources":["../../../../components/UpdateRole.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport { useRoleStore } from \"../stores/roles\";\nimport { useAuthStore } from \"../stores/login\";\nimport { useUpdateRoleStore } from \"../stores/update-role\";\nimport { usePermissionStore } from \"../stores/permissions\";\nimport { UpdateRoleParams } from \"~~/server/src/role\";\nimport { storeToRefs } from \"pinia\";\n\nconst { updateRole, unsetError } = useUpdateRoleStore();\n\nconst { user } = storeToRefs(useAuthStore());\nconst { selectedRole, refreshRolesFunction, editIsToActivateRole } =\n  storeToRefs(useRoleStore());\n\nconst { computedPermission } = storeToRefs(usePermissionStore());\nconst {\n  initializeTogglePermissionsArrayWithSomeItemsChecked,\n} = usePermissionStore();\n\nconst {\n  data: resources,\n  pending,\n  error,\n  refresh,\n} = await useFetch(\"/api/resources/list\", {\n  query: {\n    accessToken: user.value.refresh_token,\n  },\n});\n\ninitializeTogglePermissionsArrayWithSomeItemsChecked(\n  resources.value,\n  selectedRole.value\n);\n\nconst showNoPermissionCheckedError = ref(false);\n\nconst {\n  pending: updateRoleIsPending,\n  error: updateIsErroring,\n  responseOK,\n} = storeToRefs(useUpdateRoleStore());\n\nconst name = ref(selectedRole.value.name);\n\nconst editRole = async () => {\n  if (computedPermission.value == null) {\n    showNoPermissionCheckedError.value = true;\n    return;\n  }\n\n  const accessToken = user.value.refresh_token;\n  const permission = \"\" + computedPermission.value;\n  const roleID = selectedRole.value.id;\n  const body = { name: name.value, permission, status: 1 };\n  await updateRole(body, accessToken, roleID);\n  if (responseOK.value) {\n    navigateTo(\"/permissions\");\n  }\n};\n\nonBeforeUnmount(() => {\n  unsetError();\n});\n</script>\n<template>\n  <div class=\"shadow-md p-5 bg-white h-full overflow-scroll\">\n    <form @submit.prevent=\"editRole\" class=\"w-full h-full overflow-auto\">\n      <div class=\"mb-3\">\n        <label\n          for=\"name\"\n          class=\"block text-sm font-semibold leading-6 text-gray-900\"\n          >Role Name</label\n        ><input\n          type=\"text\"\n          id=\"name\"\n          v-model=\"name\"\n          placeholder=\"Enter role name\"\n          class=\"appearance-none text-slate-900 bg-gray-50 rounded-md block w-full px-3 h-10 shadow-sm sm:text-sm focus:outline-none placeholder:text-slate-400 focus:ring-2 focus:ring-sky-500 ring-1 ring-slate-200\"\n          :class=\"{\n            ' bg-red-100':\n              updateIsErroring.hasError && updateIsErroring.field === 'name',\n          }\"\n          required\n        />\n      </div>\n      <p\n        v-if=\"updateIsErroring.hasError && updateIsErroring.field === 'name'\"\n        class=\"text-red-500 mb-6 text-sm\"\n      >\n        {{ updateIsErroring.message }}\n      </p>\n      <h4 class=\"mt-4\">Assign Permissions</h4>\n      <div\n        class=\"border rounded-md mb-3 border-gray-200 h-[32rem] overflow-scroll\"\n      >\n        <ThePermissions />\n      </div>\n\n      <div\n        v-if=\"showNoPermissionCheckedError\"\n        class=\"text-red-500 text-sm mb-3\"\n      >\n        No permission selected\n      </div>\n      <button\n        type=\"submit\"\n        class=\"rounded-lg text-sm font-semibold py-2.5 px-4 text-sky-50 bg-teal-700 hover:text-sky-50/80 hover:bg-teal-600\"\n      >\n        <spin v-if=\"updateRoleIsPending\" />\n        <span v-else>Update Role</span>\n      </button>\n    </form>\n  </div>\n</template>\n"],"names":["_withAsyncContext"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAQA,uBAAA;AAEA,UAAA,EAAA,KAAA,IAAA,YAAA,aAAA,CAAA;AACA,UAAA,EAAA,cAAA,sBAAA,qBAAA,IAAA,YAAA,aAAA,CAAA;AAGA,gBAAA,mBAAA,CAAA;AACA,UAAA;AAAA,MAAM;AAAA,IACJ,IAAA,mBAAA;AAGF,UAAA;AAAA,MAAM,MAAA;AAAA,MACE;AAAA,MACN;AAAA,MACA;AAAA,IACA,KAAA,CAAA,QAAA,SAAA,IAAAA,iBAAA,MAAA,SAAA,uBAAA;AAAA,MACwC,OAAA;AAAA,QACjC,aAAA,KAAA,MAAA;AAAA,MACmB;AAAA,IAC1B,GAAA,aAAA,CAAA,GAAA,SAAA,MAAA,QAAA,UAAA,GAAA;AAGF;AAAA,MAAA,UAAA;AAAA,MACY,aAAA;AAAA,IACG;AAGf,UAAA,+BAAA,IAAA,KAAA;AAEA,UAAA;AAAA,MAAM,SAAA;AAAA,MACK,OAAA;AAAA,MACF;AAAA,IACP,IAAA,YAAA,mBAAA,CAAA;AAGF,UAAA,OAAA,IAAA,aAAA,MAAA,IAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;"}