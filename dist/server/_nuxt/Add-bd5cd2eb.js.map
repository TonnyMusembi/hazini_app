{"version":3,"file":"Add-bd5cd2eb.js","sources":["../../../../stores/create-role.ts","../../../../components/AddRole.vue"],"sourcesContent":["import { CreateRoleParams } from \"~/server/src/role\";\n\nexport interface CreateRoleError {\n  hasError: boolean;\n  message: string;\n  field: string;\n}\nexport interface CreateRoleState {\n  pending: boolean;\n  error: CreateRoleError;\n  responseOK: boolean;\n}\nexport const useCreateRoleStore = defineStore(\"create-role-store\", {\n  state: (): CreateRoleState => ({\n    pending: false,\n    error: {\n      hasError: false,\n      message: \"\",\n      field: \"\",\n    },\n    responseOK: false,\n  }),\n\n  actions: {\n    async createRole(body: CreateRoleParams, accessToken: string) {\n      try {\n        this.pending = true;\n        let error = {\n          hasError: false,\n          message: \"\",\n          field: \"\",\n        };\n        this.error = error;\n        let responseOK = false;\n        this.responseOK = responseOK;\n\n        const { data } = await useFetch(\"/api/roles/create\", {\n          method: \"post\",\n          body: { body, accessToken },\n\n          async onResponse({ request, response, options }) {\n            // Process the response data\n            if (response.ok) {\n              responseOK = true;\n            }\n          },\n\n          async onResponseError({ request, response, options }) {\n            if (response.status == 400) {\n              error = {\n                hasError: true,\n                message: \"permission or name not provided\",\n                field: \"none\",\n              };\n            }\n            if (response.status === 403) {\n              error = {\n                hasError: true,\n                message: \"Role name already exists\",\n                field: \"name\",\n              };\n            }\n            if (response.status === 500) {\n              error = {\n                hasError: true,\n                message: \"Internal server error\",\n                field: \"none\",\n              };\n            }\n          },\n        });\n        this.pending = false;\n        this.error = error;\n        this.responseOK = responseOK;\n      } catch (err) {\n        this.pending = false;\n      }\n    },\n  },\n});\n","<script setup lang=\"ts\">\nimport { CreateRoleParams } from \"~~/server/src/role\";\nimport { useCreateRoleStore } from \"../stores/create-role\";\nimport { usePermissionStore } from \"../stores/permissions\";\nimport { useAuthStore } from \"../stores/login\";\nimport { storeToRefs } from \"pinia\";\n\nconst { createRole } = useCreateRoleStore();\nconst { computedPermission } = storeToRefs(usePermissionStore());\nconst { unsetTogglePermissionsArray } = usePermissionStore();\nconst {\n  pending: addRoleIsPending,\n  error: addRoleIsErroring,\n  responseOK,\n} = storeToRefs(useCreateRoleStore());\nconst { user } = storeToRefs(useAuthStore());\nconst name = ref(\"\");\nconst showNoPermissionCheckedError = ref(false);\n\nconst createNewRole = async () => {\n  if (computedPermission.value == null) {\n    showNoPermissionCheckedError.value = true;\n    return;\n  }\n  const accessToken = user.value.refresh_token;\n  const role: CreateRoleParams = {\n    name: name.value,\n    permission: \"\" + computedPermission.value,\n  };\n  await createRole(role, accessToken);\n  if (responseOK.value) {\n    unsetTogglePermissionsArray();\n    navigateTo(\"/permissions\");\n  }\n};\nonUnmounted(() => {\n  unsetTogglePermissionsArray();\n});\n</script>\n<template>\n  <div class=\"shadow-md p-5 bg-white h-full overflow-scroll\">\n    <form @submit.prevent=\"createNewRole\" class=\"w-full h-full overflow-auto\">\n      <div class=\"mb-3\">\n        <label\n          for=\"name\"\n          class=\"block text-sm font-semibold leading-6 text-gray-900\"\n          >Role Name</label\n        ><input\n          type=\"text\"\n          id=\"name\"\n          v-model=\"name\"\n          placeholder=\"Enter role name\"\n          class=\"appearance-none text-slate-900 bg-gray-50 rounded-md block w-full px-3 h-10 shadow-sm sm:text-sm focus:outline-none placeholder:text-slate-400 focus:ring-2 focus:ring-sky-500 ring-1 ring-slate-200\"\n          :class=\"{\n            ' bg-red-100':\n              addRoleIsErroring.hasError && addRoleIsErroring.field === 'name',\n          }\"\n          required\n        />\n      </div>\n      <p\n        v-if=\"addRoleIsErroring.hasError && addRoleIsErroring.field === 'name'\"\n        class=\"text-red-500 mb-6 text-sm\"\n      >\n        {{ addRoleIsErroring.message }}\n      </p>\n      <h4 class=\"mt-4\">Assign Permissions</h4>\n      <div\n        class=\"border rounded-md mb-3 border-gray-200 h-[32rem] overflow-scroll\"\n      >\n        <ThePermissions />\n      </div>\n\n      <div\n        v-if=\"showNoPermissionCheckedError\"\n        class=\"text-red-500 text-sm mb-3\"\n      >\n        No permission selected\n      </div>\n      <button\n        type=\"submit\"\n        class=\"rounded-lg text-sm font-semibold py-2.5 px-4 text-sky-50 bg-teal-700 hover:text-sky-50/80 hover:bg-teal-600\"\n      >\n        <spin v-if=\"addRoleIsPending\" />\n        <span v-else>Add Role</span>\n      </button>\n    </form>\n  </div>\n</template>\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AAYO,MAAA,qBAAA,YAAA,qBAAA;AAAA,EAA4D,OAAA,OAAA;AAAA,IAClC,SAAA;AAAA,IACpB,OAAA;AAAA,MACF,UAAA;AAAA,MACK,SAAA;AAAA,MACD,OAAA;AAAA,IACF;AAAA,IACT,YAAA;AAAA,EACY;AAAA,EACd,SAAA;AAAA,IAES,MAAA,WAAA,MAAA,aAAA;AAEL,UAAA;AACE,aAAA,UAAA;AACA,YAAA,QAAA;AAAA,UAAY,UAAA;AAAA,UACA,SAAA;AAAA,UACD,OAAA;AAAA,QACF;AAET,aAAA,QAAA;AACA,YAAA,aAAA;AACA,aAAA,aAAA;AAEA,cAAA,EAAA,KAAA,IAAA,MAAA,SAAA,qBAAA;AAAA,UAAqD,QAAA;AAAA,UAC3C,MAAA,EAAA,MAAA,YAAA;AAAA,UACkB,MAAA,WAAA,EAAA,SAAA,UAAA,QAAA,GAAA;AAIxB,gBAAA,SAAA,IAAA;AACE,2BAAA;AAAA,YAAa;AAAA,UACf;AAAA,UACF,MAAA,gBAAA,EAAA,SAAA,UAAA,QAAA,GAAA;AAGE,gBAAA,SAAA,UAAA,KAAA;AACE,sBAAA;AAAA,gBAAQ,UAAA;AAAA,gBACI,SAAA;AAAA,gBACD,OAAA;AAAA,cACF;AAAA,YACT;AAEF,gBAAA,SAAA,WAAA,KAAA;AACE,sBAAA;AAAA,gBAAQ,UAAA;AAAA,gBACI,SAAA;AAAA,gBACD,OAAA;AAAA,cACF;AAAA,YACT;AAEF,gBAAA,SAAA,WAAA,KAAA;AACE,sBAAA;AAAA,gBAAQ,UAAA;AAAA,gBACI,SAAA;AAAA,gBACD,OAAA;AAAA,cACF;AAAA,YACT;AAAA,UACF;AAAA,QACF,GAAA,aAAA;AAEF,aAAA,UAAA;AACA,aAAA,QAAA;AACA,aAAA,aAAA;AAAA,MAAkB,SAAA,KAAA;AAElB,aAAA,UAAA;AAAA,MAAe;AAAA,IACjB;AAAA,EACF;AAEJ,CAAA;;;;;ACxEA,uBAAA;AACA,gBAAA,mBAAA,CAAA;AACA,UAAA,EAAA,gCAAA;AACA,UAAA;AAAA,MAAM,SAAA;AAAA,MACK,OAAA;AAAA,MACF;AAAA,IACP,IAAA,YAAA,mBAAA,CAAA;AAEF,gBAAA,aAAA,CAAA;AACA,UAAA,OAAA,IAAA,EAAA;AACA,UAAA,+BAAA,IAAA,KAAA;AAkBA,gBAAA,MAAA;AACE;IAA4B,CAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;"}