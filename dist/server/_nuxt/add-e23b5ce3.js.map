{"version":3,"file":"add-e23b5ce3.js","sources":["../../../../stores/create-loan-product.ts","../../../../components/AddLoanProduct.vue"],"sourcesContent":["import { LoanProduct } from \"~/server/src/loan-product\";\n\nexport interface CreateLoanProductState {\n  pending: boolean;\n  responseOK: boolean;\n  nonFieldErrors: string;\n  fieldErrors: Array<{ field: string; description: string }> | null;\n}\nexport const useCreateLoanProductStore = defineStore(\"create-Loan-product-store\", {\n  state: (): CreateLoanProductState => ({\n    pending: false,\n    responseOK: false,\n    nonFieldErrors: \"\",\n    fieldErrors: null,\n  }),\n\n  actions: {\n    async createLoanProduct(body: LoanProduct, accessToken: string) {\n      try {\n        this.pending = true;\n        let nonFieldErrors = \"\";\n        let fieldErrors = null;\n        let responseOK = false;\n        this.responseOK = responseOK;\n\n        const { data } = await useFetch(\"/api/loan-products/create\", {\n          method: \"post\",\n          body: { body, accessToken },\n\n          async onResponse({ request, response, options }) {\n            // Process the response data\n            if (response.ok) {\n              responseOK = true;\n            }\n          },\n\n          async onResponseError({ request, response, options }) {\n            if (response.status == 400) {\n              fieldErrors = response._data?.data.errors;\n            }\n            if (response.status == 401) {\n              nonFieldErrors = \"Unauthorised\";\n            }\n            if (response.status === 403) {\n              nonFieldErrors = response._data?.data.error;\n            }\n            if (response.status === 500) {\n              nonFieldErrors = \"Internal Error\";\n            }\n          },\n        });\n        this.pending = false;\n        this.fieldErrors = fieldErrors;\n        this.nonFieldErrors = nonFieldErrors;\n        this.responseOK = responseOK;\n      } catch (err) {\n        this.pending = false;\n      }\n    },\n  },\n});\n","<script setup lang=\"ts\">\nimport { useCreateLoanProductStore } from \"../stores/create-loan-product\";\nimport { useAuthStore } from \"../stores/login\";\nimport { getErrorByField, fieldHasError } from \"~/utils/errors\";\nimport { LoanProduct } from \"~~/server/src/loan-product\";\n\nconst { createLoanProduct } = useCreateLoanProductStore();\nconst { pending, nonFieldErrors, fieldErrors, responseOK } = storeToRefs(\n  useCreateLoanProductStore()\n);\nconst { user } = storeToRefs(useAuthStore());\n\nconst {\n  data: companies,\n  pending: fetchingCompanyIsPending,\n  error,\n  refresh,\n} = await useFetch(\"/api/company/list\", {\n  query: {\n    pageSize: 10,\n    pageID: 1,\n    accessToken: user.value.refresh_token,\n  },\n});\n\nconst name = ref(\"\");\nconst interest = ref();\nconst duration = ref();\nconst installments = ref();\nconst maximumPrincipal = ref();\nconst maximumInterest = ref();\nconst waiver = ref();\nconst transactionCost = ref();\nconst companyID = ref();\nconst status = ref();\n\nconst createNewCompany = async () => {\n  const accessToken = user.value.refresh_token;\n  const loanProduct: LoanProduct = {\n    name: name.value,\n    interest: interest.value,\n    duration: duration.value,\n    installments: installments.value,\n    maximum_principal: maximumPrincipal.value,\n    maximum_interest: maximumInterest.value,\n    waiver: waiver.value,\n    transaction_cost: transactionCost.value,\n    company_id: companyID.value,\n    status: 1,\n  };\n  await createLoanProduct(loanProduct, accessToken);\n  if (responseOK.value) {\n    navigateTo(\"/loan-products\");\n  }\n};\n\nconst title = ref(\"Add Company\"); // change current title\n</script>\n<template>\n  <div class=\"shadow-md p-5 bg-white h-[40rem] overflow-scroll\">\n    <p class=\"text-red-500 mb-6\">\n      {{ nonFieldErrors }}\n    </p>\n    <form @submit.prevent=\"createNewCompany\" class=\"w-full\">\n      <div class=\"mb-3\">\n        <label for=\"company\" class=\"block text-sm font-semibold leading-6 text-gray-900\">Select Company</label><select\n          v-model=\"companyID\" id=\"company\" :class=\"{\n            'ring-1 ring-red-500 bg-red-50': fieldHasError(\n              fieldErrors,\n              'CompanyID'\n            ),\n          }\"\n          class=\"block appearance-none w-full bg-gray-200 border border-gray-200 text-gray-700 py-3 px-4 pr-8 rounded leading-tight focus:outline-none focus:bg-white focus:border-gray-500\">\n          <option v-for=\"company in companies\" :value=\"company.id\" :key=\"company.id\">\n            {{ company.name }}\n          </option>\n        </select>\n        <p class=\"text-red-500 mb-6 text-sm\">\n          {{ getErrorByField(fieldErrors, \"CompanyID\") }}\n        </p>\n      </div>\n\n      <div class=\"mb-3\">\n        <label for=\"name\" class=\"block text-sm font-semibold leading-6 text-gray-900\">Name</label><input type=\"text\"\n          id=\"name\" v-model=\"name\" :class=\"{\n            'ring-1 ring-red-500 bg-red-50': fieldHasError(fieldErrors, 'Name'),\n          }\"\n          class=\"appearance-none text-slate-900 bg-gray-50 rounded-md block w-full px-3 h-10 shadow-sm sm:text-sm focus:outline-none placeholder:text-slate-400 focus:ring-2 focus:ring-sky-500 ring-1 ring-slate-200\"\n          required />\n        <p class=\"text-red-500 mb-6 text-sm\">\n          {{ getErrorByField(fieldErrors, \"Name\") }}\n        </p>\n      </div>\n      <div class=\"mb-3\">\n        <label for=\"interest\" class=\"block text-sm font-semibold leading-6 text-gray-900\">Interest</label><input\n          type=\"number\" step=\"0.01\" id=\"interest\" :class=\"{\n            'ring-1 ring-red-500 bg-red-50': fieldHasError(\n              fieldErrors,\n              'Interest'\n            ),\n          }\"\n          class=\"appearance-none text-slate-900 bg-gray-50 rounded-md block w-full px-3 h-10 shadow-sm sm:text-sm focus:outline-none placeholder:text-slate-400 focus:ring-2 focus:ring-sky-500 focus:bg-white ring-1 ring-slate-200\"\n          aria-required v-model=\"interest\" />\n        <p class=\"text-red-500 mb-6 text-sm\">\n          {{ getErrorByField(fieldErrors, \"Interest\") }}\n        </p>\n      </div>\n      <div class=\"mb-3\">\n        <label for=\"duration\" class=\"block text-sm font-semibold leading-6 text-gray-900\">Duration In days</label><input\n          type=\"number\" id=\"duration\" :class=\"{\n            'ring-1 ring-red-500 bg-red-50': fieldHasError(\n              fieldErrors,\n              'Duration'\n            ),\n          }\"\n          class=\"appearance-none text-slate-900 bg-gray-50 rounded-md block w-full px-3 h-10 shadow-sm sm:text-sm focus:outline-none placeholder:text-slate-400 focus:ring-2 focus:ring-sky-500 focus:bg-white ring-1 ring-slate-200\"\n          aria-required min=\"60\" v-model=\"duration\" />\n        <p class=\"text-red-500 mb-6 text-sm\">\n          {{ getErrorByField(fieldErrors, \"Duration\") }}\n        </p>\n      </div>\n      <div class=\"mb-3\">\n        <label for=\"installments\" class=\"block text-sm font-semibold leading-6 text-gray-900\">Installments</label><input\n          type=\"number\" id=\"installments\" min=\"0\" :class=\"{\n            'ring-1 ring-red-500 bg-red-50': fieldHasError(\n              fieldErrors,\n              'Installments'\n            ),\n          }\"\n          class=\"appearance-none text-slate-900 bg-gray-50 rounded-md block w-full px-3 h-10 shadow-sm sm:text-sm focus:outline-none placeholder:text-slate-400 focus:ring-2 focus:ring-sky-500 ring-1 ring-slate-200\"\n          required v-model=\"installments\" />\n        <p class=\"text-red-500 mb-6 text-sm\">\n          {{ getErrorByField(fieldErrors, \"Installments\") }}\n        </p>\n      </div>\n\n      <div class=\"mb-3\">\n        <label for=\"maximum-principal\"\n          class=\"block text-sm font-semibold leading-6 text-gray-900\">MaximumPrincipal</label><input type=\"number\"\n          id=\"maximum-principal\" min=\"500\" :class=\"{\n            'ring-1 ring-red-500 bg-red-50': fieldHasError(\n              fieldErrors,\n              'MaximumPrincipal'\n            ),\n          }\"\n          class=\"appearance-none text-slate-900 bg-gray-50 rounded-md block w-full px-3 h-10 shadow-sm sm:text-sm focus:outline-none placeholder:text-slate-400 focus:ring-2 focus:ring-sky-500 focus:bg-white ring-1 ring-slate-200\"\n          aria-required v-model=\"maximumPrincipal\" />\n        <p class=\"text-red-500 mb-6 text-sm\">\n          {{ getErrorByField(fieldErrors, \"MaximumPrincipal\") }}\n        </p>\n      </div>\n      <div class=\"mb-3\">\n        <label for=\"maximum-interest\"\n          class=\"block text-sm font-semibold leading-6 text-gray-900\">MaximumInterest</label><input type=\"number\"\n          id=\"maximum-interest\" step=\"0.01\" min=\".4\" :class=\"{\n            'ring-1 ring-red-500 bg-red-50': fieldHasError(\n              fieldErrors,\n              'MaximumInterest'\n            ),\n          }\"\n          class=\"appearance-none text-slate-900 bg-gray-50 rounded-md block w-full px-3 h-10 shadow-sm sm:text-sm focus:outline-none placeholder:text-slate-400 focus:ring-2 focus:ring-sky-500 focus:bg-white ring-1 ring-slate-200\"\n          aria-required v-model=\"maximumInterest\" />\n        <p class=\"text-red-500 mb-6 text-sm\">\n          {{ getErrorByField(fieldErrors, \"MaximumInterest\") }}\n        </p>\n      </div>\n      <div class=\"mb-3\">\n        <label for=\"waiver\" class=\"block text-sm font-semibold leading-6 text-gray-900\">Waiver</label><input type=\"number\"\n          id=\"waiver\" step=\"0.01\" min=\"0\" :class=\"{\n            'ring-1 ring-red-500 bg-red-50': fieldHasError(\n              fieldErrors,\n              'Waiver'\n            ),\n          }\"\n          class=\"appearance-none text-slate-900 bg-gray-50 rounded-md block w-full px-3 h-10 shadow-sm sm:text-sm focus:outline-none placeholder:text-slate-400 focus:ring-2 focus:ring-sky-500 focus:bg-white ring-1 ring-slate-200\"\n          aria-required v-model=\"waiver\" />\n        <p class=\"text-red-500 mb-6 text-sm\">\n          {{ getErrorByField(fieldErrors, \"Waiver\") }}\n        </p>\n      </div>\n      <div class=\"mb-3\">\n        <label for=\"transaction-cost\" class=\"block text-sm font-semibold leading-6 text-gray-900\">Transaction\n          Cost</label><input type=\"number\" id=\"transaction-cost\" step=\"0.01\" min=\"0\" :class=\"{\n            'ring-1 ring-red-500 bg-red-50': fieldHasError(\n              fieldErrors,\n              'TransactionCost'\n            ),\n          }\"\n          class=\"appearance-none text-slate-900 bg-gray-50 rounded-md block w-full px-3 h-10 shadow-sm sm:text-sm focus:outline-none placeholder:text-slate-400 focus:ring-2 focus:ring-sky-500 focus:bg-white ring-1 ring-slate-200\"\n          aria-required v-model=\"transactionCost\" />\n        <p class=\"text-red-500 mb-6 text-sm\">\n          {{ getErrorByField(fieldErrors, \"TransactionCost\") }}\n        </p>\n      </div>\n\n      <button type=\"submit\"\n        class=\"inline-flex rounded-lg text-sm font-semibold py-2.5 px-4 text-sky-50 bg-teal-700 hover:text-sky-50/80 hover:bg-teal-600\">\n        <spin v-if=\"pending\" />\n        <span v-else>Add Loan Product</span>\n      </button>\n    </form>\n  </div>\n</template>\n"],"names":["_withAsyncContext"],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAQO,MAAA,4BAAA,YAAA,6BAAA;AAAA,EAA2E,OAAA,OAAA;AAAA,IAC1C,SAAA;AAAA,IAC3B,YAAA;AAAA,IACG,gBAAA;AAAA,IACI,aAAA;AAAA,EACH;AAAA,EACf,SAAA;AAAA,IAES,MAAA,kBAAA,MAAA,aAAA;AAEL,UAAA;AACE,aAAA,UAAA;AACA,YAAA,iBAAA;AACA,YAAA,cAAA;AACA,YAAA,aAAA;AACA,aAAA,aAAA;AAEA,cAAA,EAAA,KAAA,IAAA,MAAA,SAAA,6BAAA;AAAA,UAA6D,QAAA;AAAA,UACnD,MAAA,EAAA,MAAA,YAAA;AAAA,UACkB,MAAA,WAAA,EAAA,SAAA,UAAA,QAAA,GAAA;AAIxB,gBAAA,SAAA,IAAA;AACE,2BAAA;AAAA,YAAa;AAAA,UACf;AAAA,UACF,MAAA,gBAAA,EAAA,SAAA,UAAA,QAAA,GAAA;;AAGE,gBAAA,SAAA,UAAA,KAAA;AACE,6BAAA,cAAA,UAAA,mBAAA,KAAA;AAAA,YAAmC;AAErC,gBAAA,SAAA,UAAA,KAAA;AACE,+BAAA;AAAA,YAAiB;AAEnB,gBAAA,SAAA,WAAA,KAAA;AACE,gCAAA,cAAA,UAAA,mBAAA,KAAA;AAAA,YAAsC;AAExC,gBAAA,SAAA,WAAA,KAAA;AACE,+BAAA;AAAA,YAAiB;AAAA,UACnB;AAAA,QACF,GAAA,aAAA;AAEF,aAAA,UAAA;AACA,aAAA,cAAA;AACA,aAAA,iBAAA;AACA,aAAA,aAAA;AAAA,MAAkB,SAAA,KAAA;AAElB,aAAA,UAAA;AAAA,MAAe;AAAA,IACjB;AAAA,EACF;AAEJ,CAAA;;;;;;ACtDA,8BAAA;AACA,UAAA,EAAA,SAAA,gBAAA,aAAA,WAAA,IAAA;AAAA,MAA6D,0BAAA;AAAA,IACjC;AAE5B,UAAA,EAAA,KAAA,IAAA,YAAA,aAAA,CAAA;AAEA,UAAA;AAAA,MAAM,MAAA;AAAA,MACE,SAAA;AAAA,MACG;AAAA,MACT;AAAA,IACA,KAAA,CAAA,QAAA,SAAA,IAAAA,iBAAA,MAAA,SAAA,qBAAA;AAAA,MACsC,OAAA;AAAA,QAC/B,UAAA;AAAA,QACK,QAAA;AAAA,QACF,aAAA,KAAA,MAAA;AAAA,MACgB;AAAA,IAC1B,GAAA,aAAA,CAAA,GAAA,SAAA,MAAA,QAAA,UAAA,GAAA;AAGF,UAAA,OAAA,IAAA,EAAA;AACA,UAAA,WAAA;AACA,UAAA,WAAA;AACA,UAAA,eAAA;AACA,UAAA,mBAAA;AACA,UAAA,kBAAA;AACA,UAAA,SAAA;AACA,UAAA,kBAAA;AACA,QAAA;AACA,QAAA;AAsBA,QAAA,aAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;"}