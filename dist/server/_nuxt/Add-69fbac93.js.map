{"version":3,"file":"Add-69fbac93.js","sources":["../../../../stores/create-company.ts","../../../../components/AddCompany.vue"],"sourcesContent":["import { Company } from \"~/server/src/company\";\n\nexport interface CreateCompanyState {\n  pending: boolean;\n  responseOK: boolean;\n  nonFieldErrors: string;\n  fieldErrors: Array<{ field: string; description: string }> | null;\n}\nexport const useCreateCompanyStore = defineStore(\"create-company-store\", {\n  state: (): CreateCompanyState => ({\n    pending: false,\n    responseOK: false,\n    nonFieldErrors: \"\",\n    fieldErrors: null,\n  }),\n\n  actions: {\n    async createCompany(body: Company, accessToken: string) {\n      try {\n        this.pending = true;\n        let nonFieldErrors = \"\";\n        let fieldErrors = null;\n        let responseOK = false;\n        this.responseOK = responseOK;\n\n        const { data } = await useFetch(\"/api/company/create\", {\n          method: \"post\",\n          body: { body, accessToken },\n\n          async onResponse({ request, response, options }) {\n            // Process the response data\n            if (response.ok) {\n              responseOK = true;\n            }\n          },\n\n          async onResponseError({ request, response, options }) {\n            if (response.status == 400) {\n              fieldErrors = response._data?.data.errors;\n              \n            }\n            if (response.status == 401) {\n              nonFieldErrors = \"Unauthorised\";\n            }\n            if (response.status === 403) {\n              nonFieldErrors = response._data?.data.error;\n            }\n            if (response.status === 500) {\n              nonFieldErrors = \"Internal Error\";\n            }\n          },\n        });\n        this.pending = false;\n        this.fieldErrors = fieldErrors;\n        this.nonFieldErrors = nonFieldErrors;\n        this.responseOK = responseOK;\n      } catch (err) {\n        this.pending = false;\n      }\n    },\n  },\n});\n","<script setup lang=\"ts\">\nimport { Company } from \"~/server/src/company\";\nimport { useCreateCompanyStore } from \"../stores/create-company\";\nimport { useAuthStore } from \"../stores/login\";\nimport { getErrorByField, fieldHasError } from \"~/utils/errors\";\n\nconst { createCompany } = useCreateCompanyStore();\nconst { pending, nonFieldErrors, fieldErrors, responseOK } = storeToRefs(\n  useCreateCompanyStore()\n);\nconst { user } = storeToRefs(useAuthStore());\n\nconst name = ref(\"\");\nconst physicalAddress = ref(\"\");\nconst maxLoanPercent = ref(0);\nconst numberOfEmployees = ref(0);\nconst loanPeriod = ref(\"\");\nconst approvesLoan = ref(false);\nconst status = ref(1);\nconst profitSharePercent = ref(0);\n\nconst createNewCompany = async () => {\n  const accessToken = user.value.refresh_token;\n  const company: Company = {\n    name: name.value,\n    physical_address: physicalAddress.value,\n    max_loan_percent: maxLoanPercent.value,\n    number_of_employees: numberOfEmployees.value,\n    loan_period: loanPeriod.value,\n    approves_loan: approvesLoan.value,\n    status: status.value,\n    profit_share_percent: profitSharePercent.value,\n  };\n  await createCompany(company, accessToken);\n  if (responseOK.value) {\n    navigateTo(\"/companies\");\n  }\n};\n\nconst title = ref(\"Add Company\"); // change current title\n</script>\n<template>\n  <div class=\"shadow-md p-3 bg-white\">\n    <p class=\"text-red-500 mb-6\">\n      {{ nonFieldErrors }}\n    </p>\n    <form @submit.prevent=\"createNewCompany\" class=\"w-full\">\n      <div class=\"mb-3\">\n        <label for=\"name\" class=\"block text-sm font-semibold leading-6 text-gray-900\">Name</label><input type=\"text\"\n          id=\"name\" v-model=\"name\" :class=\"{\n            'ring-1 ring-red-500 bg-red-50': fieldHasError(fieldErrors, 'Name'),\n          }\"\n          class=\"appearance-none text-slate-900 bg-gray-50 rounded-md block w-full px-3 h-10 shadow-sm sm:text-sm focus:outline-none placeholder:text-slate-400 focus:ring-2 focus:ring-sky-500 ring-1 ring-slate-200\"\n          required />\n        <p class=\"text-red-500 mb-6 text-sm\">\n          {{ getErrorByField(fieldErrors, \"Name\") }}\n        </p>\n      </div>\n      <div class=\"mb-3\">\n        <label for=\"physical-address\" class=\"block text-sm font-semibold leading-6 text-gray-900\">Physical\n          Address</label><input type=\"text\" id=\"physical-address\" :class=\"{\n            'ring-1 ring-red-500 bg-red-50': fieldHasError(\n              fieldErrors,\n              'PhysicalAddress'\n            ),\n          }\"\n          class=\"appearance-none text-slate-900 bg-gray-50 rounded-md block w-full px-3 h-10 shadow-sm sm:text-sm focus:outline-none placeholder:text-slate-400 focus:ring-2 focus:ring-sky-500 focus:bg-white ring-1 ring-slate-200\"\n          aria-required v-model=\"physicalAddress\" />\n        <p class=\"text-red-500 mb-6 text-sm\">\n          {{ getErrorByField(fieldErrors, \"PhysicalAddress\") }}\n        </p>\n      </div>\n      <div class=\"mb-3\">\n        <label for=\"number-of-employees\" class=\"block text-sm font-semibold leading-6 text-gray-900\">Number of\n          Employees</label><input type=\"number\" id=\"number-of-employees\" :class=\"{\n            'ring-1 ring-red-500 bg-red-50': fieldHasError(\n              fieldErrors,\n              'NumberOfEmployees'\n            ),\n          }\"\n          class=\"appearance-none text-slate-900 bg-gray-50 rounded-md block w-full px-3 h-10 shadow-sm sm:text-sm focus:outline-none placeholder:text-slate-400 focus:ring-2 focus:ring-sky-500 focus:bg-white ring-1 ring-slate-200\"\n          aria-required min=\"1\" v-model=\"numberOfEmployees\" />\n        <p class=\"text-red-500 mb-6 text-sm\">\n          {{ getErrorByField(fieldErrors, \"NumberOfEmployees\") }}\n        </p>\n      </div>\n      <div class=\"mb-3\">\n        <label for=\"max-loan-percent\" class=\"block text-sm font-semibold leading-6 text-gray-900\">Max percent of loan\n          amount that can be taken as loan</label><input type=\"number\" id=\"max-loan-percent\" step=\"0.01\" min=\"0\" :class=\"{\n            'ring-1 ring-red-500 bg-red-50': fieldHasError(\n              fieldErrors,\n              'MaxLoanPercent'\n            ),\n          }\"\n          class=\"appearance-none text-slate-900 bg-gray-50 rounded-md block w-full px-3 h-10 shadow-sm sm:text-sm focus:outline-none placeholder:text-slate-400 focus:ring-2 focus:ring-sky-500 ring-1 ring-slate-200\"\n          required v-model=\"maxLoanPercent\" />\n        <p class=\"text-red-500 mb-6 text-sm\">\n          {{ getErrorByField(fieldErrors, \"MaxLoanPercent\") }}\n        </p>\n      </div>\n\n      <div class=\"mb-3\">\n        <label for=\"profit-share-percent\" class=\"block text-sm font-semibold leading-6 text-gray-900\">Percentage of\n          interest retained by this company</label><input type=\"number\" id=\"profit-share-percent\" step=\"0.01\" min=\"0\"\n          :class=\"{\n            'ring-1 ring-red-500 bg-red-50': fieldHasError(\n              fieldErrors,\n              'ProfitSharePercent'\n            ),\n          }\"\n          class=\"appearance-none text-slate-900 bg-gray-50 rounded-md block w-full px-3 h-10 shadow-sm sm:text-sm focus:outline-none placeholder:text-slate-400 focus:ring-2 focus:ring-sky-500 focus:bg-white ring-1 ring-slate-200\"\n          aria-required v-model=\"profitSharePercent\" />\n        <p class=\"text-red-500 mb-6 text-sm\">\n          {{ getErrorByField(fieldErrors, \"ProfitSharePercent\") }}\n        </p>\n      </div>\n      <div class=\"mb-3\">\n        <label for=\"loan-period\" class=\"block text-sm font-semibold leading-6 text-gray-900\">Period employees are allowed\n          to request loan</label>\n        {{ loanPeriod }}\n        <input type=\"range\" id=\"loan-period\" min=\"1\" max=\"28\"\n          class=\"text-slate-900 rounded-md block w-full px-3 h-10 sm:text-sm focus:outline-none placeholder:text-slate-400\"\n          aria-required v-model=\"loanPeriod\" />\n        <p class=\"text-red-500 mb-6 text-sm\">\n          {{ getErrorByField(fieldErrors, \"LoanPeriod\") }}\n        </p>\n      </div>\n      <div class=\"mb-3\">\n        <label for=\"approves-loan\" class=\"block text-sm font-semibold leading-6 mb-5 text-gray-900\">Should loans be\n          approved?</label>\n        <label class=\"inline-flex relative items-center mr-5 cursor-pointer\">\n          <input type=\"checkbox\" id=\"approves-loan\" class=\"sr-only peer\" v-model=\"approvesLoan\" required />\n          <div\n            class=\"w-11 h-6 bg-gray-200 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-teal-600\">\n          </div>\n          <div class=\"text-[#2C7075] ml-3\">{{ approvesLoan }}</div>\n        </label>\n        <p class=\"text-red-500 mb-6 text-sm\">\n          {{ getErrorByField(fieldErrors, \"ApprovesLoan\") }}\n        </p>\n      </div>\n      <button type=\"submit\"\n        class=\"inline-flex rounded-lg text-sm font-semibold py-2.5 px-4 text-sky-50 bg-teal-700 hover:text-sky-50/80 hover:bg-teal-600\">\n        <spin v-if=\"pending\" />\n        <span v-else>Add Company</span>\n      </button>\n    </form>\n  </div>\n</template>\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAQO,MAAA,wBAAA,YAAA,wBAAA;AAAA,EAAkE,OAAA,OAAA;AAAA,IACrC,SAAA;AAAA,IACvB,YAAA;AAAA,IACG,gBAAA;AAAA,IACI,aAAA;AAAA,EACH;AAAA,EACf,SAAA;AAAA,IAES,MAAA,cAAA,MAAA,aAAA;AAEL,UAAA;AACE,aAAA,UAAA;AACA,YAAA,iBAAA;AACA,YAAA,cAAA;AACA,YAAA,aAAA;AACA,aAAA,aAAA;AAEA,cAAA,EAAA,KAAA,IAAA,MAAA,SAAA,uBAAA;AAAA,UAAuD,QAAA;AAAA,UAC7C,MAAA,EAAA,MAAA,YAAA;AAAA,UACkB,MAAA,WAAA,EAAA,SAAA,UAAA,QAAA,GAAA;AAIxB,gBAAA,SAAA,IAAA;AACE,2BAAA;AAAA,YAAa;AAAA,UACf;AAAA,UACF,MAAA,gBAAA,EAAA,SAAA,UAAA,QAAA,GAAA;;AAGE,gBAAA,SAAA,UAAA,KAAA;AACE,6BAAA,cAAA,UAAA,mBAAA,KAAA;AAAA,YAAmC;AAGrC,gBAAA,SAAA,UAAA,KAAA;AACE,+BAAA;AAAA,YAAiB;AAEnB,gBAAA,SAAA,WAAA,KAAA;AACE,gCAAA,cAAA,UAAA,mBAAA,KAAA;AAAA,YAAsC;AAExC,gBAAA,SAAA,WAAA,KAAA;AACE,+BAAA;AAAA,YAAiB;AAAA,UACnB;AAAA,QACF,GAAA,aAAA;AAEF,aAAA,UAAA;AACA,aAAA,cAAA;AACA,aAAA,iBAAA;AACA,aAAA,aAAA;AAAA,MAAkB,SAAA,KAAA;AAElB,aAAA,UAAA;AAAA,MAAe;AAAA,IACjB;AAAA,EACF;AAEJ,CAAA;;;;;ACvDA,0BAAA;AACA,UAAA,EAAA,SAAA,gBAAA,aAAA,WAAA,IAAA;AAAA,MAA6D,sBAAA;AAAA,IACrC;AAExB,gBAAA,aAAA,CAAA;AAEA,UAAA,OAAA,IAAA,EAAA;AACA,UAAA,kBAAA,IAAA,EAAA;AACA,UAAA,iBAAA,IAAA,CAAA;AACA,UAAA,oBAAA,IAAA,CAAA;AACA,UAAA,aAAA,IAAA,EAAA;AACA,UAAA,eAAA,IAAA,KAAA;AACA,QAAA,CAAA;AACA,UAAA,qBAAA,IAAA,CAAA;AAoBA,QAAA,aAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;"}